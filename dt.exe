#include <REGX51.H>


	 sbit rs=P3^2;
	 sbit rw=P3^3;
	 sbit en=P3^4;
	
 	 sfr datas=0xA0;


  #define MYDATA P0
	sbit A1=P1^0;
	sbit A2=P1^1;
	sbit A3=P1^2;

	 void lcdinit(void);
	 void lcdcmd(unsigned char );	 
	 void delay(unsigned int del);		
	 void lcddata(unsigned char ldat);	
	 
	 void lcdinit(void)
	 {
	 lcdcmd(0x38);
	 lcdcmd(0x38);
	 lcdcmd(0x38);
	 lcdcmd(0x06);
	 lcdcmd(0x0e);
	 lcdcmd(0x01);
	 lcdcmd(0x0C);
	 lcdcmd(0x80);
	 }

	void lcdcmd(unsigned char lcmd)
	{
	 datas=lcmd;
	 rs=0;
	 rw=0;
	 en=1;
 	 delay(100);
	 en=0;
	}
	

	void delay(unsigned int del)
	{
	while(del--);
 	}

	void lcddata(unsigned char ldat) 
	{
	 datas=ldat;
	 rs=1;
	 rw=0;
	 en=1;
   	 delay(100);
	 en=0;
 	}

void Delay();

void init()
   {
    SCON=0x50;
    TMOD=0X20;
    TH1=0XFD;
    TR1=1;
   }

void txs(unsigned char value)
  {
   TI=0;
   SBUF=value;
   while(TI==0);
  }

unsigned char val1[6],val,sp,spt,spf;
	
	

	

void main()
   {
   unsigned char i=0,oc=0;
   unsigned char hb=0;
   init();
   lcdinit();
 	   txs('A');txs('T');txs(13);delay(60000); delay(60000);
    while(1)
    {
	while(RI==0)
	{

	A1=0;
	A2=0;
	A3=0;
	Delay();
  val1[1]=MYDATA/5;
	
	lcdcmd(0x80);
	lcddata('T');
	lcddata((val1[1]/100)+0x30);
	lcddata(((val1[1]%100)/10)+0x30);
	lcddata((val1[1]%10)+0x30);	
											  	
	A1=1;
	A2=0;
	A3=0;
	Delay();
  val1[2]=MYDATA/5;
   val1[2]= (val1[2]+2)	;
	lcddata(' ');
	lcddata((val1[2]/100)+0x30);
	lcddata(((val1[2]%100)/10)+0x30);
	lcddata((val1[2]%10)+0x30);	

	A1=0;
	A2=1;
	A3=0;
	Delay();
  val1[3]=MYDATA+3;
	lcdcmd(0xc0);
	lcddata('P');
	lcddata((val1[3]/100)+0x30);
	lcddata(((val1[3]%100)/10)+0x30);
	lcddata((val1[3]%10)+0x30);	


	A1=1;
	A2=1;
	A3=0;
	Delay();
  val1[4]=MYDATA+5;
	lcddata(' ');
	lcddata((val1[4]/100)+0x30);
	lcddata(((val1[4]%100)/10)+0x30);
	lcddata((val1[4]%10)+0x30);	


	A1=0;
	A2=0;
	A3=1;
	Delay();
  val1[5]=MYDATA;
	lcdcmd(0x8A);
	lcddata('V');
	lcddata((val1[5]/100)+0x30);
	lcddata(((val1[5]%100)/10)+0x30);
	lcddata((val1[5]%10)+0x30);	


	A1=1;
	A2=0;
	A3=1;
	Delay();
  val1[6]=MYDATA/6;
		 val1[6]= (val1[6]-19);
	lcdcmd(0xca);
	lcddata('L');
	lcddata((val1[6]/100)+0x30);
	lcddata(((val1[6]%100)/10)+0x30);
	lcddata((val1[6]%10)+0x30);	


if(val1[1]>40)
{
	P3_5=1;
}
else
{
	P3_5=0;
}
  if((val1[5]>100)&&	(val1[6]>10))
{
	P3_7=0;	 delay(10000); delay(100000);
	 P3_7=1;delay(10000); delay(100000);


}

else if((val1[5]<100)&&	(val1[6]<10))
{
	P3_7=0;	 delay(10000); delay(100000);delay(10000); delay(100000);
	 P3_7=1;	delay(10000); delay(10000);delay(10000); delay(100000);

}

else if((val1[5]>100)&&	(val1[6]<10))
{
	P3_7=0;//	 delay(100); delay(100); delay(100); delay(100); delay(100); delay(100); P3_7=0;	delay(100); delay(100); delay(100) ;


}
else
{
	P3_7=1;
}
if(val1[3]>40)
{
	P3_6=1;
}
else
{
	P3_6=0;
}



if(oc==0)
{
oc=100;
	txs('*');
	txs('T');
	txs('1');
	txs(':');
	txs((val1[1]/100)+0x30);
	txs(((val1[1]%100)/10)+0x30);
	txs((val1[1]%10)+0x30);			
	txs('_');
	txs('T');
	txs('2');
	txs(':');
	txs((val1[2]/100)+0x30);
	txs(((val1[2]%100)/10)+0x30);
	txs((val1[2]%10)+0x30);			
	txs('_');
	txs('P');
	txs('1');
	txs(':');
	txs((val1[3]/100)+0x30);
	txs(((val1[3]%100)/10)+0x30);
	txs((val1[3]%10)+0x30);			
	txs('_');
	txs('P');
	txs('2');
	txs(':');
	txs((val1[4]/100)+0x30);
	txs(((val1[4]%100)/10)+0x30);
	txs((val1[4]%10)+0x30);			
	txs('_');
	txs('V');
	txs(':');
	txs((val1[5]/100)+0x30);
	txs(((val1[5]%100)/10)+0x30);
	txs((val1[5]%10)+0x30);			
	txs('_');
	txs('L');
	txs(':');
	txs((val1[6]/100)+0x30);
	txs(((val1[6]%100)/10)+0x30);
	txs((val1[6]%10)+0x30);	
if(val1[1]>40)
{
	txs('~');
	txs('1');	
}
else if(val1[2]>40)
{
	txs('~');
	txs('2');	
}
else if(val1[3]>100)
{
	txs('~');
	txs('3');	
}
else if(val1[4]>100)
{
	txs('~');
	txs('4');	
}
else
{
	txs('~');
	txs('0');	
}

			txs('#');

}
oc--;

	}
	RI=0;
	val=SBUF;
	switch(val)
		{
		 case 'A': P3_6=1;break;
		 case 'B': P3_6=0;break;
		 case 'C': P3_5=1;break;
		 case 'D': P3_5=0;break;
		 case 'E': P3_7=1;break;
		 case 'F': P3_7=0;break;
		 default : break;
		}
  	}
  }
   
void Delay()				                                   
{
     int i;
     for(i=0;i<20000;i++)
	 	{
		}
}